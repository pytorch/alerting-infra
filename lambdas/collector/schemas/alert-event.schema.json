{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "$id": "https://schemas.pytorch.org/alerting/alert-event.schema.json",
  "title": "AlertEvent",
  "description": "Canonical alert event schema for the PyTorch Test Infrastructure Alerting System",
  "type": "object",
  "properties": {
    "schema_version": {
      "type": "integer",
      "minimum": 1,
      "description": "Schema version for future migrations (currently 1)"
    },
    "source": {
      "type": "string",
      "minLength": 1,
      "maxLength": 50,
      "pattern": "^[a-zA-Z0-9_-]+$",
      "description": "Alert source identifier",
      "examples": ["grafana", "cloudwatch", "datadog", "pagerduty", "custom"]
    },
    "state": {
      "type": "string",
      "enum": ["FIRING", "RESOLVED"],
      "description": "Current alert state"
    },
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 500,
      "description": "Alert title or name"
    },
    "description": {
      "type": "string",
      "maxLength": 4000,
      "description": "Optional detailed alert description"
    },
    "summary": {
      "type": "string",
      "maxLength": 1000,
      "description": "Optional high-level summary for prominent display"
    },
    "reason": {
      "type": "string",
      "maxLength": 2000,
      "description": "Optional provider-specific reason or message"
    },
    "priority": {
      "type": "string",
      "enum": ["P0", "P1", "P2", "P3"],
      "description": "Canonical priority level"
    },
    "occurred_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO8601 timestamp of when the alert state changed"
    },
    "teams": {
      "type": "array",
      "minItems": 1,
      "maxItems": 10,
      "items": {
        "type": "string",
        "minLength": 1,
        "maxLength": 50,
        "pattern": "^[a-zA-Z0-9_-]+$"
      },
      "description": "Owning team identifiers (normalized with hyphens)"
    },
    "identity": {
      "type": "object",
      "properties": {
        "account_id": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "pattern": "^[a-zA-Z0-9_-]+$",
          "description": "Unified account identifier (AWS account ID, organization ID, tenant ID, etc.)"
        },
        "region": {
          "type": "string",
          "maxLength": 50,
          "pattern": "^[a-zA-Z0-9_-]+$",
          "description": "AWS region or equivalent"
        },
        "alarm_id": {
          "type": "string",
          "maxLength": 1024,
          "description": "Alarm identifier (CloudWatch alarm ARN, Grafana rule ID, etc.)"
        }
      },
      "additionalProperties": false,
      "description": "Identity information for cross-account/region collision prevention"
    },
    "links": {
      "type": "object",
      "properties": {
        "runbook_url": {
          "type": "string",
          "format": "uri",
          "maxLength": 2048,
          "description": "URL to runbook or playbook for this alert"
        },
        "dashboard_url": {
          "type": "string",
          "format": "uri",
          "maxLength": 2048,
          "description": "URL to monitoring dashboard"
        },
        "source_url": {
          "type": "string",
          "format": "uri",
          "maxLength": 2048,
          "description": "URL to alert source (console, panel, etc.)"
        },
        "silence_url": {
          "type": "string",
          "format": "uri",
          "maxLength": 2048,
          "description": "URL to silence or mute this alert"
        }
      },
      "additionalProperties": false,
      "description": "Navigation and action links related to the alert"
    },
    "raw_provider": {
      "description": "Original, pre-normalization provider payload preserved for debugging purposes"
    }
  },
  "required": [
    "schema_version",
    "source",
    "state",
    "title",
    "priority",
    "occurred_at",
    "teams",
    "identity",
    "links"
  ],
  "additionalProperties": false,
  "examples": [
    {
      "schema_version": 1,
      "source": "datadog",
      "state": "FIRING",
      "title": "High CPU Usage on prod-web-01",
      "description": "CPU utilization has exceeded 90% for 5 minutes",
      "summary": "Critical CPU alert on production web server",
      "priority": "P1",
      "occurred_at": "2024-01-15T10:30:00.000Z",
      "teams": ["platform-team"],
      "identity": {
        "account_id": "123456789012",
        "region": "us-west-2",
        "alarm_id": "cpu-high-prod-web"
      },
      "links": {
        "runbook_url": "https://wiki.company.com/runbooks/high-cpu",
        "dashboard_url": "https://datadog.com/dashboard/cpu-monitoring",
        "source_url": "https://datadog.com/monitors/12345"
      },
      "raw_provider": {
        "monitor_id": 12345,
        "original_payload": "..."
      }
    }
  ]
}
